<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõí Resumo do Pedido | A Doce Maninha</title>
    <link rel="icon" href="https://via.placeholder.com/32/A0522D/FFFFFF?text=BP" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS B√ÅSICO DO INDEX (Para Tema Consistente) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Quicksand', sans-serif;
        }

        :root {
            --cor-principal: #A0522D;
            --cor-fundo: #FFF5E0;
            --cor-secundaria: #694F3C;
            --cor-texto-claro: #FFFFFF;
            --cor-nav-clara: #F8E5D3;
            --cor-destaque-clara: #ffe0b2; /* Laranja suave */
        }

        body {
            background-color: var(--cor-fundo);
            color: var(--cor-secundaria);
            padding-bottom: 100px;
        }

        /* HEADER */
        .header {
            background-color: var(--cor-principal);
            color: var(--cor-texto-claro);
            padding: 20px 0 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header h1 { font-size: 1.8em; margin-bottom: 5px; }
        .header p { font-size: 1em; font-weight: 400; }
        
        /* NOVO: ESTILO DO MENU DE FILTRO/NAVEGA√á√ÉO */
        .filter-menu {
            padding: 20px 10px;
            text-align: center;
            background-color: var(--cor-fundo);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        .filter-btn {
            background-color: var(--cor-nav-clara); 
            color: var(--cor-secundaria);
            border: 1px solid var(--cor-principal);
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
            font-size: 1em;
            display: inline-block;
            text-decoration: none;
        }
        
        /* CONTAINER PRINCIPAL */
        .cart-container {
            max-width: 700px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .cart-container h2 {
            text-align: center;
            color: var(--cor-principal);
            margin: 25px 0 15px;
            font-size: 1.8em;
        }

        /* ESTILO DO ITEM NO CARRINHO */
        .cart-item {
            display: flex;
            align-items: center;
            background-color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .item-details {
            flex-grow: 1;
            padding-right: 15px;
        }

        .item-details h3 {
            font-size: 1.2em;
            color: var(--cor-secundaria);
            margin-bottom: 3px;
        }

        .item-details p {
            font-size: 0.9em;
            color: #777;
        }

        .item-price {
            font-weight: 700;
            color: var(--cor-principal);
            font-size: 1.1em;
            text-align: right;
            min-width: 80px;
        }

        /* CONTROLE DE QUANTIDADE (NOVO!) */
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: var(--cor-destaque-clara);
            border-radius: 5px;
            padding: 5px;
        }
        .quantity-btn {
            background-color: var(--cor-principal);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 5px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            line-height: 1;
            transition: background-color 0.1s;
        }
        .quantity-btn:hover { background-color: var(--cor-secundaria); }
        .item-quantity {
            font-weight: 700;
            width: 20px;
            text-align: center;
            color: var(--cor-secundaria);
        }
        
        /* BOT√ÉO DE REMOVER (LIXEIRA) */
        .remove-btn {
            background: none;
            border: none;
            color: #dc3545;
            font-size: 1.2em;
            margin-left: 10px;
            cursor: pointer;
            transition: color 0.1s;
        }
        .remove-btn:hover { color: #8d0000; }


        /* RESUMO DE PRE√áOS */
        .price-summary {
            background-color: var(--cor-nav-clara);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        .price-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .total-line {
            border-top: 2px solid var(--cor-principal);
            padding-top: 10px;
            margin-top: 10px;
            font-size: 1.3em;
            font-weight: 700;
            color: var(--cor-principal);
        }

        /* BOT√ÉO DE WHATSAPP FLUTUANTE */
        .whatsapp-checkout {
            position: fixed;
            bottom: 20px;
            right: 50%;
            transform: translateX(50%);
            z-index: 1000;
            background-color: #25D366; 
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            width: 90%;
            max-width: 400px;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .whatsapp-checkout:hover { background-color: #128C7E; }

        /* MENSAGEM DE CARRINHO VAZIO */
        #empty-cart-message {
            text-align: center;
            padding: 50px 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            font-size: 1.2em;
            color: #888;
        }
    </style>
</head>
<body>

    <header class="header">
        <h1>üõí Seu Pedido</h1>
        <p>A Doce Maninha | Resumo para Finaliza√ß√£o</p>
    </header>

    <div class="filter-menu">
        <a href="index.html" class="filter-btn">üç∞ Card√°pio</a>
        <a href="sobre.html" class="filter-btn">üß° Sobre N√≥s</a>
        <a href="entrega.html" class="filter-btn">üõµ Entrega & Frete</a>
    </div>

    <section class="cart-container">
        
        <h2>Seu Carrinho</h2>

        <div id="empty-cart-message" style="display: none;">
            Seu carrinho est√° vazio. üòî<br>
            <a href="index.html" style="color: var(--cor-principal); font-weight: bold; text-decoration: none;">Adicione alguns bolos no pote!</a>
        </div>

        <div id="cart-items-container">
            </div>

        <div id="price-summary" class="price-summary" style="display: none;">
            <div class="price-line">
                <span>Subtotal dos Produtos:</span>
                <span id="subtotal">R$ 0,00</span>
            </div>
            <div class="price-line total-line">
                <span>TOTAL DO PEDIDO:</span>
                <span id="total-price">R$ 0,00</span>
            </div>
            <p style="font-size: 0.85em; margin-top: 15px; color: #888;">
                *Frete n√£o incluso. Ser√° combinado e adicionado no WhatsApp.
            </p>
        </div>

    </section>

    <a href="#" id="whatsapp-checkout-btn" class="whatsapp-checkout" style="display: none;" target="_blank">
        üì≤ FINALIZAR PEDIDO (R$ 0,00)
    </a>

    <script>
        // 1. FUN√á√ïES B√ÅSICAS DE CARRINHO
        function loadCart() {
            const cartJson = localStorage.getItem('cart');
            return cartJson ? JSON.parse(cartJson) : [];
        }

        function saveCart(cart) {
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart(); // Renderiza o carrinho sempre que houver mudan√ßa
        }
        
        // 2. L√ìGICA DE GEST√ÉO DE QUANTIDADE/REMO√á√ÉO
        
        // Fun√ß√£o para modificar a quantidade de um item no carrinho
        function modifyQuantity(index, change) {
            let cart = loadCart();
            
            // Certifica-se de que o item existe e n√£o √© a Promo√ß√£o Trio (que tem l√≥gica especial)
            if (cart[index] && !cart[index].flavor.startsWith('Trio (')) {
                cart[index].quantity += change;
                
                // Se a quantidade for <= 0, remove o item
                if (cart[index].quantity <= 0) {
                    cart.splice(index, 1);
                }
            } else if (cart[index] && cart[index].flavor.startsWith('Trio (')) {
                 // L√≥gica especial para a promo√ß√£o trio (remove o pacote inteiro)
                 if (change < 0) {
                    removeCartItem(index);
                    return; // Sai da fun√ß√£o ap√≥s a remo√ß√£o
                 } else {
                     alert("Para adicionar mais Promo√ß√µes Trio, voc√™ deve voltar ao Card√°pio.");
                 }
            }
            
            saveCart(cart);
        }

        // Fun√ß√£o para remover um item espec√≠fico do carrinho
        function removeCartItem(index) {
            let cart = loadCart();
            cart.splice(index, 1);
            saveCart(cart);
        }

        // 3. FUN√á√ÉO DE C√ÅLCULO E RENDERIZA√á√ÉO
        function calculateTotal(cart) {
            return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function createWhatsappLink(cart, total) {
            if (cart.length === 0) return '';

            let message = "Ol√°, Amanda! Meu pedido da A Doce Maninha √© o seguinte:\n\n";
            let totalItemCount = 0;

            cart.forEach((item, index) => {
                const itemPrice = (item.price * item.quantity).toFixed(2).replace('.', ',');
                
                // Ajusta a mensagem para promo√ß√µes vs. itens individuais
                if (item.flavor.startsWith('Trio (')) {
                    // Mensagem especial para a promo√ß√£o trio
                    message += `${index + 1}. *PROMO√á√ÉO TRIO (${item.size})*\n`;
                    message += `   - Quantidade: 1 pacote (equivale a ${item.quantity} potes)\n`;
                    message += `   - Valor: R$ ${itemPrice}\n`;
                    message += `   - **ATEN√á√ÉO:** Sabores a serem escolhidos no chat.\n\n`;
                    totalItemCount += item.quantity;
                } else {
                    // Mensagem para itens normais
                    message += `${index + 1}. ${item.quantity}x ${item.flavor} (${item.size})\n`;
                    message += `   - Valor Unit√°rio: R$ ${item.price.toFixed(2).replace('.', ',')}\n`;
                    message += `   - Subtotal: R$ ${itemPrice}\n\n`;
                    totalItemCount += item.quantity;
                }
            });

            const totalPriceFormatted = total.toFixed(2).replace('.', ',');
            message += `------------------------------\n`;
            message += `*SUBTOTAL DO PEDIDO:* R$ ${totalPriceFormatted}\n`;
            message += `*Total de itens (Potes):* ${totalItemCount}\n`;
            message += "------------------------------\n\n";
            message += "Favor, calcular o frete para [Seu Endere√ßo Completo].\n\n";
            message += "Qual a forma de pagamento?\n\n";

            // Encodifica a mensagem para URL
            return `https://api.whatsapp.com/send?phone=5547989141263&text=${encodeURIComponent(message)}`;
        }

        function renderCart() {
            const cart = loadCart();
            const container = document.getElementById('cart-items-container');
            const emptyMessage = document.getElementById('empty-cart-message');
            const summary = document.getElementById('price-summary');
            const whatsappBtn = document.getElementById('whatsapp-checkout-btn');
            
            container.innerHTML = '';
            
            if (cart.length === 0) {
                emptyMessage.style.display = 'block';
                summary.style.display = 'none';
                whatsappBtn.style.display = 'none';
                return;
            }

            emptyMessage.style.display = 'none';
            summary.style.display = 'block';
            whatsappBtn.style.display = 'flex';

            cart.forEach((item, index) => {
                const itemTotal = (item.price * item.quantity);
                const isPromo = item.flavor.startsWith('Trio (');
                
                // Texto de descri√ß√£o adaptado
                const descriptionText = isPromo 
                    ? `Promo√ß√£o - ${item.size}` 
                    : `Tamanho: ${item.size} (R$ ${item.price.toFixed(2).replace('.', ',')})`
                
                const itemHtml = `
                    <div class="cart-item">
                        <div class="item-details">
                            <h3>${item.flavor}</h3>
                            <p>${descriptionText}</p>
                        </div>

                        ${isPromo ? 
                        // Se for promo√ß√£o trio, apenas mostra 1x e remove
                        `<div class="quantity-control">
                            <span class="item-quantity">1x</span>
                        </div>
                        <div class="item-price">R$ ${itemTotal.toFixed(2).replace('.', ',')}</div>
                        <button class="remove-btn" onclick="removeCartItem(${index})">üóëÔ∏è</button>`
                        :
                        // Se for item normal, permite +/- e remove
                        `<div class="quantity-control">
                            <button class="quantity-btn" onclick="modifyQuantity(${index}, -1)">-</button>
                            <span class="item-quantity">${item.quantity}</span>
                            <button class="quantity-btn" onclick="modifyQuantity(${index}, 1)">+</button>
                        </div>
                        <div class="item-price">R$ ${itemTotal.toFixed(2).replace('.', ',')}</div>
                        <button class="remove-btn" onclick="removeCartItem(${index})">üóëÔ∏è</button>`
                        }
                    </div>
                `;
                container.innerHTML += itemHtml;
            });

            // Atualiza o Resumo
            const total = calculateTotal(cart);
            const totalFormatted = total.toFixed(2).replace('.', ',');
            
            document.getElementById('subtotal').textContent = `R$ ${totalFormatted}`;
            document.getElementById('total-price').textContent = `R$ ${totalFormatted}`;

            // Atualiza o bot√£o de finaliza√ß√£o
            whatsappBtn.textContent = `üì≤ FINALIZAR PEDIDO (R$ ${totalFormatted})`;
            whatsappBtn.href = createWhatsappLink(cart, total);
        }

        // 4. INICIALIZA√á√ÉO
        document.addEventListener('DOMContentLoaded', renderCart);
    </script>
</body>
</html>
